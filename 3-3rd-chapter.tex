\chapter{Реализация компонента}
\label{cha:ch_3}

\section{Кнопка меню}

В верстке используем \texttt{ImageView}, предназначенную для отображения
иконок~\cite{ImageView}.
В \texttt{BenderHamburgerViewHolder} поддерживаем два состояния:
с красной точкой и без нее.
Устанавливаем иконку в зависимости от указываемого состояния.
Кроме того, позволяем снаружи подписываться на событие клика
по~\texttt{ImageView}.

\section{Строка статуса}

В верстке используем \texttt{TextView}, позволяющий отображать текст
и иконки вокруг текста~\cite{TextView}.
В \texttt{BenderStatusTextViewHolder} поддерживаем два состояния:
онлайн и офлайн.
В онлайн-состоянии слева от текста проставляем иконку-стрелку,
текст меняем на название города, передаваемого при переходе в это состояние.
В~офлайн-состоянии проставляем иконку с изображением восклицательного знака
и текст \mbox{«Нет подключения к сети»}.
Позволяем снаружи подписаться на событие клика в онлайн-состоянии,
чтобы пользователь мог вручную изменить город.

\section{Счетчик браузерных вкладок}

В верстке используем \texttt{TextView} для отображения количества
открытых вкладок.
В \texttt{BenderBrowserTabCounterViewHolder} поддерживаем изменение числа
и позволяем снаружи подписываться на событие клика.

\section{Логотип}

В верстке используем \texttt{ImageView}.
Из \texttt{BenderLogoAndDoodleViewHolder} по умолчанию устанавливаем логотип
в качестве картинки, но позволяем менять ее снаружи.
Позволяем снаружи подписываться на событие клика.

\section{Омнибокс}

В верстке для самого омнибокса используем контейнер \texttt{FrameLayout},
позволяющий размещать элементы независимо друг от друга~\cite{FrameLayout}.
Устанавливаем ему фон, внутрь кладем \texttt{ImageView} для кнопки камеры
и \texttt{TextView} для названия текущего экрана в схлопнутом состоянии.
В \texttt{BenderOmniboxViewHolder} позволяем подписываться на события
клика по омнибоксу и по кнопке камеры.

\section{Информеры}

В верстке для информера используем \texttt{LinearLayout},
внутрь которого кладем \texttt{ImageView} для иконки
и \texttt{TextView} для текста.
В \texttt{BenderInformerViewHolder} поддерживаем изменение иконки и текста,
позволяем подписываться на события клика.
Элементы верстки для каждого информера складываем в общий для них
контейнер \texttt{LinearLayout} с горизонтальной ориентацией.

После этого для каждого конкретного информера создаем свой класс,
в который помещаем логику установки иконки и текста.
Этим классам делегируем логику через \texttt{BenderInformerContainerViewHolder}.

\section{Вкладки сервисов}

В верстке отдельной вкладки используем \texttt{LinearLayout},
внутрь него кладем \texttt{ImageView} для иконки и \texttt{TextView} для текста.
В \texttt{BenderTabViewHolder} поддерживаем два состояния:
активное с~яркой иконкой и жирным текстом
и неактивное с~черно-белой иконкой и обычным текстом.
Также позволяем подписываться на события клика.

После этого вкладки нужно поместить в контейнер со специфической логикой.
Контейнер должен запрашивать у каждого элемента, который в нем лежит,
размер минимальной ширины, которую этот элемент должен занимать,
после этого проставлять такой размер всем элементам,
чтобы ширина каждого элемента была одинаковой.
При этом, если не все элементы помещаются на экран,
то контейнер должен скроллиться.
А если помещаются, то поместить их нужно в центре контейнера.

Готового такого контейнера нет, но можем реализовать свой~\cite{CustomView}.
Им становится \texttt{BenderTabLayoutSlidingStrip} — унаследованный
от \texttt{ViewGroup} — предка всех контейнеров — контейнер,
поддержавший всю описанную выше логику, за исключением скроллинга.
Его помещаем внутрь \texttt{HorizontalScrollView},
который, как следует из его названия, и поддерживает нужный скроллинг.
При~наследовании переопределяем метод \texttt{onMeasure}, вычисляющий
высоту и ширину контейнера по его элементам, а также метод \texttt{onLayout},
вычисляющий координаты для размещения каждого элемента.

Логику наполнения элементами \texttt{BenderTabLayoutSlidingStrip}
и управления их состояниями размещаем в~\texttt{BenderTabLayoutViewHolder}.
Позволяем подписываться снаружи на клики по элементам
(при клике сообщаем индекс элемента, на который кликнули).

\section{Анимация схлопывания}

При схлопывании нам известен коэффициент слопывания — вещественное число,
равное 0 для расхлопнутого и 1 для полностью схлопнутого Бендера.
С помощью него мы рассчитываем коэффициент непрозрачности, смещение
и размеры изменяющихся элементов, после чего применяем их
к соответствующим элементам.
